<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>2 Usage 2.0-RC2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security LDAP Plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/usage.html"><strong>2</strong><span>Usage</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>3</strong><span>Configuration</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>LDAP authentication support for the Spring Security plugin.</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security LDAP Plugin</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/configuration.html"><strong>3</strong><span>Configuration</span> >></a></div>
                


                <div class="project">
                    <h1>2 Usage - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Burt Beckwith</p>

                    <p><strong>Version:</strong> 2.0-RC2</p>

                    
                </div>

                

                

<h1 id="usage">2 Usage</h1>
<blockquote class="note">
Configuring your LDAP server is beyond the scope of this document. There are many different approaches and this will most likely be done by IT staff. It's assumed here that you already have a running LDAP or Active Directory server.
</blockquote><p class="paragraph"/>There isn't much that you need to do in your application to use LDAP. Just install this plugin, and configure any required parameters and whatever optional parameters you want in Config.groovy. These are described in detail in guide:3. Configuration but typically you only need to set these properties<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.ldap.context. managerDn = 'uid=admin,ou=system'
grails.plugin.springsecurity.ldap.context. managerPassword = 'secret'
grails.plugin.springsecurity.ldap.context. server = 'ldap://localhost:10389'
grails.plugin.springsecurity.ldap.authorities. groupSearchBase = 'ou=groups,dc=yourcompany,dc=com'
grails.plugin.springsecurity.ldap.search. base = 'dc=yourcompany,dc=com'</pre></div><p class="paragraph"/>Often all role information will be stored in LDAP, but if you want to also assign application-specific roles to users in the database, then add this<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.ldap.authorities.retrieveDatabaseRoles = <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/>to do an extra database lookup after the LDAP lookup.<p class="paragraph"/>Depending on how passwords are encrypted in LDAP you may also need to configure the encryption algorithm, e.g.<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.password.algorithm = 'SHA&#45;256'</pre></div><p class="paragraph"/><h4> Sample Config.groovy settings for Active Directory</h4><p class="paragraph"/>Active directory is somewhat different although still relatively painless if you know what you are doing. Use these example configuration options to get started (tested in Windows Server 2008):<p class="paragraph"/><blockquote class="note">
Replace the placeholders inside  brackets with appropriate values and remove the  chars
</blockquote><p class="paragraph"/><div class="code"><pre>// LDAP config
grails.plugin.springsecurity.ldap. context.managerDn = '&#91;distinguishedName&#93;'
grails.plugin.springsecurity.ldap. context.managerPassword = '&#91;password&#93;'
grails.plugin.springsecurity.ldap. context.server = 'ldap://&#91;ip&#93;:&#91;port&#93;/'
grails.plugin.springsecurity.ldap. authorities.ignorePartialResultException = <span class="java&#45;keyword">true</span> // typically needed <span class="java&#45;keyword">for</span> Active Directory
grails.plugin.springsecurity.ldap. search.base = '&#91;the base directory to start the search.  usually something like dc=mycompany,dc=com&#93;'
grails.plugin.springsecurity.ldap. search.filter=<span class="java&#45;quote">"sAMAccountName=&#123;0&#125;"</span> // <span class="java&#45;keyword">for</span> Active Directory you need <span class="java&#45;keyword">this</span>
grails.plugin.springsecurity.ldap. search.searchSubtree = <span class="java&#45;keyword">true</span>
grails.plugin.springsecurity.ldap. auth.hideUserNotFoundExceptions = <span class="java&#45;keyword">false</span>
grails.plugin.springsecurity.ldap. search.attributesToReturn = &#91;'mail', 'displayName'&#93; // extra attributes you want returned; see below <span class="java&#45;keyword">for</span> custom classes that access <span class="java&#45;keyword">this</span> data
grails.plugin.springsecurity.providerNames = &#91;'ldapAuthProvider', 'anonymousAuthenticationProvider'&#93; // specify <span class="java&#45;keyword">this</span> when you want to skip attempting to load from db and only use LDAP<p class="paragraph"/>// role&#45;specific LDAP config
grails.plugin.springsecurity.ldap.useRememberMe = <span class="java&#45;keyword">false</span>
grails.plugin.springsecurity.ldap.authorities.retrieveGroupRoles = <span class="java&#45;keyword">true</span>
grails.plugin.springsecurity.ldap.authorities.groupSearchBase ='&#91;the base directory to start the search.  usually something like dc=mycompany,dc=com&#93;'
// If you don't want to support group membership recursion (groups in groups), then use the following setting
// grails.plugin.springsecurity.ldap.authorities.groupSearchFilter = 'member=&#123;0&#125;' // Active Directory specific
// If you wish to support groups with group as members (recursive groups), use the following
grails.plugin.springsecurity.ldap.authorities.groupSearchFilter = '(member:1.2.840.113556.1.4.1941:=&#123;0&#125;)' // Active Directory specific</pre></div><p class="paragraph"/><h4>Custom UserDetailsContextMapper</h4><p class="paragraph"/>There are three options for mapping LDAP attributes to <code>UserDetails</code> data (as specified by the <code>grails.plugin.springsecurity.ldap.mapper.userDetailsClass</code> config attribute) and hopefully one of those will be sufficient for your needs. If not, it's easy to implement <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/ldap/userdetails/UserDetailsContextMapper.html" target="blank">UserDetailsContextMapper</a> yourself.<p class="paragraph"/>Create a class in <code>src/groovy</code> or <code>src/java</code> that implements <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/ldap/userdetails/UserDetailsContextMapper.html" target="blank">UserDetailsContextMapper</a> and register it in <code>grails-app/conf/spring/resources.groovy</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> com.mycompany.myapp.MyUserDetailsContextMapper<p class="paragraph"/>beans = &#123;
   ldapUserDetailsMapper(MyUserDetailsContextMapper) &#123;
      // bean attributes
   &#125;
&#125;</pre></div><p class="paragraph"/>For example, here's a custom <code>UserDetailsContextMapper</code> that extracts three additional fields from LDAP (fullname, email, and title)<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/><span class="java&#45;keyword">import</span> org.springframework.ldap.core.DirContextAdapter
<span class="java&#45;keyword">import</span> org.springframework.ldap.core.DirContextOperations
<span class="java&#45;keyword">import</span> org.springframework.security.core.userdetails.UserDetails
<span class="java&#45;keyword">import</span> org.springframework.security.ldap.userdetails.UserDetailsContextMapper<p class="paragraph"/>class MyUserDetailsContextMapper <span class="java&#45;keyword">implements</span> UserDetailsContextMapper &#123;<p class="paragraph"/>   UserDetails mapUserFromContext(DirContextOperations ctx, <span class="java&#45;object">String</span> username,
                                  Collection authorities) &#123;<p class="paragraph"/>      <span class="java&#45;object">String</span> fullname = ctx.originalAttrs.attrs&#91;'name'&#93;.values&#91;0&#93;
      <span class="java&#45;object">String</span> email = ctx.originalAttrs.attrs&#91;'mail'&#93;.values&#91;0&#93;.toString().toLowerCase()
      def title = ctx.originalAttrs.attrs&#91;'title'&#93;<p class="paragraph"/>      <span class="java&#45;keyword">new</span> MyUserDetails(username, <span class="java&#45;keyword">null</span>, <span class="java&#45;keyword">true</span>, <span class="java&#45;keyword">true</span>, <span class="java&#45;keyword">true</span>, <span class="java&#45;keyword">true</span>,
                        authorities, fullname, email,
                        title == <span class="java&#45;keyword">null</span> ? '' : title.values&#91;0&#93;)
   &#125;<p class="paragraph"/>   void mapUserToContext(UserDetails user, DirContextAdapter ctx) &#123;
      <span class="java&#45;keyword">throw</span> <span class="java&#45;keyword">new</span> IllegalStateException(<span class="java&#45;quote">"Only retrieving data from AD is currently supported"</span>)
   &#125;
&#125;</pre></div><p class="paragraph"/>and a custom <code>UserDetails</code> class to hold the extra fields:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.mycompany.myapp<p class="paragraph"/><span class="java&#45;keyword">import</span> org.springframework.security.core.GrantedAuthority
<span class="java&#45;keyword">import</span> org.springframework.security.core.userdetails.User<p class="paragraph"/>class MyUserDetails <span class="java&#45;keyword">extends</span> User &#123;<p class="paragraph"/>   // extra instance variables
   <span class="java&#45;keyword">final</span> <span class="java&#45;object">String</span> fullname
   <span class="java&#45;keyword">final</span> <span class="java&#45;object">String</span> email
   <span class="java&#45;keyword">final</span> <span class="java&#45;object">String</span> title<p class="paragraph"/>   MyUserDetails(<span class="java&#45;object">String</span> username, <span class="java&#45;object">String</span> password, <span class="java&#45;object">boolean</span> enabled, <span class="java&#45;object">boolean</span> accountNonExpired,
         <span class="java&#45;object">boolean</span> credentialsNonExpired, <span class="java&#45;object">boolean</span> accountNonLocked,
         Collection&#60;GrantedAuthority&#62; authorities, <span class="java&#45;object">String</span> fullname,
         <span class="java&#45;object">String</span> email, <span class="java&#45;object">String</span> title) &#123;<p class="paragraph"/>      <span class="java&#45;keyword">super</span>(username, password, enabled, accountNonExpired, credentialsNonExpired,
            accountNonLocked, authorities)<p class="paragraph"/>      <span class="java&#45;keyword">this</span>.fullname = fullname
      <span class="java&#45;keyword">this</span>.email = email
      <span class="java&#45;keyword">this</span>.title = title
   &#125;
&#125;</pre></div><p class="paragraph"/>Here we extend the standard Spring Security <code>User</code> class for convenience, but you could also directly implement the interface or use a different base class.



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/introduction.html">&lt;&lt; <strong>1</strong><span>Introduction to the Spring Security LDAP Plugin</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/configuration.html"><strong>3</strong><span>Configuration</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>


<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body>
</html>
